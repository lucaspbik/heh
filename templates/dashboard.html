{% extends "base.html" %}
{% block title %}Dashboard - Lagerverwaltung{% endblock %}
{% block content %}
<section class="cards">
  <div class="card">
    <h2>Artikel</h2>
    <p class="number">{{ metrics.total_items }}</p>
  </div>
  <div class="card">
    <h2>Gesamtbestand</h2>
    <p class="number">{{ '%.2f'|format(metrics.total_quantity) }}</p>
  </div>
  <div class="card">
    <h2>Offene Bestellungen</h2>
    <p class="number">{{ metrics.open_orders }}</p>
  </div>
</section>

<section>
  <h2>Bestandswarnungen</h2>
  {% if metrics.low_stock %}
  <table>
    <thead>
      <tr>
        <th>Artikelnummer</th>
        <th>Bezeichnung</th>
        <th>Bestand</th>
        <th>Meldebestand</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in metrics.low_stock %}
      <tr>
        <td>{{ entry.sku }}</td>
        <td>{{ entry.name }}</td>
        <td>{{ '%.2f'|format(entry.quantity) }}</td>
        <td>{{ entry.reorder_level }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>Aktuell keine Artikel unter Meldebestand.</p>
  {% endif %}
</section>

<section>
  <h2>Letzte Bewegungen</h2>
  {% if metrics.recent_transactions %}
  <table>
    <thead>
      <tr>
        <th>Zeitpunkt</th>
        <th>Artikel</th>
        <th>Lagerort</th>
        <th>Menge</th>
        <th>Typ</th>
        <th>Referenz</th>
      </tr>
    </thead>
    <tbody>
      {% for tx in metrics.recent_transactions %}
      <tr>
        <td>{{ tx.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
        <td>{{ tx.item.name }}</td>
        <td>{{ tx.location.name }}</td>
        <td>{{ '%.2f'|format(tx.quantity) }}</td>
        <td>{{ tx.transaction_type.value }}</td>
        <td>{{ tx.reference or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>Noch keine Bewegungen vorhanden.</p>
  {% endif %}
</section>

<section class="actions">
  <h2>ERP-Aktionen</h2>
  <div class="action-buttons">
    <form method="post" action="{{ url_for('trigger_erp_export') }}">
      <button type="submit">Bestand an ERP senden</button>
    </form>
    <form method="post" action="{{ url_for('trigger_erp_sync') }}">
      <button type="submit">Bestellungen vom ERP abrufen</button>
    </form>
  </div>
</section>
{% endblock %}
